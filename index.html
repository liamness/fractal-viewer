<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="keywords" content="liamness, liam duffy, programmer, designer" />
<meta name="author" content="liam duffy" />
<meta name="dcterms.rights" content="2013 liam paul duffy" />
<title>liamness' fractal viewer</title>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />
<style type="text/css">
    html, body {
        width: 100%;
        height: 100%;
    }

    body {
        border: 0;
        margin: 0;
    }

    .popupWrap {
        position: fixed;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        transition: opacity 0.2s linear, visibility 0;
        transition-delay: 0, 0;
    }

    .popupWrap.hidden {
        transition-delay: 0, 0.2s;
        visibility: hidden;
        opacity: 0;
    }

    .popup {
        width: 400px;
        padding: 20px;
        text-align: center;
        background-color: #FFF;
        border: 5px solid #000;
        border-radius: 15px;
    }

    .popupTitle {
        font-family: sans-serif;
        font-size: 30px;
    }

    .popupText {
        font-family: sans-serif;
        font-size: 18px;
        line-height: 1.5em;
    }

    #demoWrap {
        width: 100%;
        height: 100%;
        text-align: center;
        overflow: hidden;
    }

    #controls {
        position:absolute;
        top: 0;
        right: 0;
        max-height: 100%;
    }

    #toggle {
        background-color: #000;
        text-align: center;
        font-family: roboto, calibri, sans-serif;
        font-size: 30px;
        color: #FFF;
    }

    #subcontrols {
        background-color: rgba(0, 0, 0, 0.75);
        display: none;
        padding: 12px 18px;
    }

    button {
        width: 100%;
        font-family: roboto, calibri, sans-serif;
        font-size: 18px;
        margin: 2px 0;
    }

    .slider {
        margin: 2px 0;
    }

    /* device-specific views */

    @media screen and (max-width: 800px) {
        nav {
            display: none;
        }
        #controls {
            display: none;
        }
        .popupWrap {
            display: none;
        }
    }

    /* jquery ui */

    #red .ui-slider-range { background: #ef2929; }
    #red .ui-slider-handle { border-color: #ef2929; }
    #green .ui-slider-range { background: #8ae234; }
    #green .ui-slider-handle { border-color: #8ae234; }
    #blue .ui-slider-range { background: #729fcf; }
    #blue .ui-slider-handle { border-color: #729fcf; }
    select {
        width: 100%;
        font-family: roboto, calibri, sans-serif;
        font-size: 18px;
        margin: 2px 0px;
    }

    .label {
        text-align: center;
        font-family: roboto, calibri, sans-serif;
        line-height: 2em;
        font-size: 18px;
        color: #FFF;
    }
</style>
</head>

<body>
    <div id="demoWrap">
        <canvas id="canvas" width="400" height="400">If you're seeing this, it probably means your browser doesn't support WebGL, and so you can't see this lovely demo. :(</canvas>
    </div>
    <div id="controls">
        <div id="toggle" onclick="toggle('subcontrols')">
            controls
        </div>
        <div id="subcontrols">
            <button onclick="fullscreen()">fullscreen</button><br />
            <button onclick="reset()">reset</button><br />
            <button onclick="adjColoured()">colour set</button><br />
            <span class="label">Number of Colours</span>
            <select id="numColours">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select><br />
            <span class="label">Weighting</span>
            <div class="slider" id="weight"></div>
            <span class="label">Colour to Adjust</span>
            <select id="pickColour">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select><br />
            <span class="label">Adjust Colour</span>
            <div class="slider" id="red"></div><br />
            <div class="slider" id="green"></div><br />
            <div class="slider" id="blue"></div><br />
            <button onclick="doZoom(1.5)">zoom in</button><br />
            <button onclick="doZoom(0.6666666667)">zoom out</button>
            <button onclick="screenshot()">screenshot</button>
        </div>
    </div>

    <div class="popupWrap active">
        <div class="popup">
            <p class="popupTitle"><strong>Instructions:</strong></p>
            <p class="popupText">To move the fractal, click and drag. Scroll using your mouse or trackpad to zoom. A set of extended controls, which allow custom colours to be used and generated images to be saved, is available if you click the button in the top right.</p>
            <p class="popupTitle"><strong><a onclick="removeDialog()">Click here to begin.</a></strong></p>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>

    <script id="shader-fs" type="x-shader/x-fragment">
    precision highp float;

    uniform vec2 uScreenResolution;
    uniform vec2 uRealLimits;
    uniform vec2 uImaginaryLimits;
    uniform int uNumColours;
    uniform float uWeight;
    uniform vec4 uSetColour;
    uniform vec4 uColours[10];

    void main(void) {
        bool runaway = false;
        const int iterMax = 256;
        float x0 = uRealLimits.x + (uRealLimits.y - uRealLimits.x) * (gl_FragCoord.x / uScreenResolution.x);
        float y0 = uImaginaryLimits.x + (uImaginaryLimits.y - uImaginaryLimits.x) * (gl_FragCoord.y / uScreenResolution.y);
        float x = 0.0;
        float y = 0.0;
        float x2 = 0.0;
        float y2 = 0.0;
        float temp;
        float N;

        // test for cardoid or period-2 bulb
        float q = (x0 - 0.25) * (x0 - 0.25) + y0 * y0;
        if(q * (q + (x0 - 0.25)) < 0.25 * y * y) {
            gl_FragColor = uSetColour;
        } else if(((x0 + 1.0) * (x0 + 1.0) + y0 * y0) <= 0.0625) {
            gl_FragColor = uSetColour;

        // do escape algorithm
        } else {
            for(int i = 0; i < iterMax; i++) {
                x2 = x*x;
                y2 = y*y;
                temp = x2 - y2 + x0;
                y = 2.0*x*y + y0;
                x = temp;
                if((x2 + y2) > 64.0) {
                    runaway = true;
                    N = float(i);
                    break;
                }
            }

            if(runaway) {
                float smooth = N - log(log(sqrt(x2 + y2))) / 0.69314718056;
                smooth /= float(iterMax);
                smooth = pow(smooth, uWeight);
                float period = (1.0 - smooth) * float(uNumColours) - 1.0;
                if(period < 1.0) {
                    gl_FragColor = (1.0 - period) * uColours[0] + period * uColours[1];
                } else if(period < 2.0) {
                    gl_FragColor = (2.0 - period) * uColours[1] + (period - 1.0) * uColours[2];
                } else if(period < 3.0) {
                    gl_FragColor = (3.0 - period) * uColours[2] + (period - 2.0) * uColours[3];
                } else if(period < 4.0) {
                    gl_FragColor = (4.0 - period) * uColours[3] + (period - 3.0) * uColours[4];
                } else if(period < 5.0) {
                    gl_FragColor = (5.0 - period) * uColours[4] + (period - 4.0) * uColours[5];
                } else if(period < 6.0) {
                    gl_FragColor = (6.0 - period) * uColours[5] + (period - 5.0) * uColours[6];
                } else if(period < 7.0) {
                    gl_FragColor = (7.0 - period) * uColours[6] + (period - 6.0) * uColours[7];
                } else if(period < 8.0) {
                    gl_FragColor = (8.0 - period) * uColours[7] + (period - 7.0) * uColours[8];
                } else if(period < 9.0) {
                    gl_FragColor = (9.0 - period) * uColours[8] + (period - 8.0) * uColours[9];
                }
            } else {
                gl_FragColor = uSetColour;
            }
        }
    }
    </script>

    <script id="shader-vs" type="x-shader/x-vertex">
    attribute vec2 aVertexPosition;

    void main(void) {
        gl_Position = vec4(aVertexPosition, 0.0, 1.0);
    }
    </script>

    <script type="text/javascript">
    window.onload = init;
    window.onresize = resize;

    var gl;

    function initGL(canvas) {
        try {
            gl = canvas.getContext("experimental-webgl", {
                antialias: true,
                preserveDrawingBuffer: true
            });
            gl.viewportWidth = canvas.width;
            gl.viewportHeight = canvas.height;
        } catch (e) {
        }
        if (!gl) {
            alert("Could not initialise WebGL, sorry :-(");
        }
    }

    function getShader(gl, id) {
        var shaderScript = document.getElementById(id);
        if (!shaderScript) {
            return null;
        }

        var str = "";
        var k = shaderScript.firstChild;
        while (k) {
            if (k.nodeType == 3) {
                str += k.textContent;
            }
            k = k.nextSibling;
        }

        var shader;
        if (shaderScript.type == "x-shader/x-fragment") {
            shader = gl.createShader(gl.FRAGMENT_SHADER);
        } else if (shaderScript.type == "x-shader/x-vertex") {
            shader = gl.createShader(gl.VERTEX_SHADER);
        } else {
            return null;
        }

        gl.shaderSource(shader, str);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(shader));
            return null;
        }

        return shader;
    }

    var shaderProgram;

    function initShaders() {
        var fragmentShader = getShader(gl, "shader-fs");
        var vertexShader = getShader(gl, "shader-vs");

        shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);

        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }

        gl.useProgram(shaderProgram);

        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

        updateUniforms();
    }

    function updateUniforms() {
        var uScreenResolutionLoc = gl.getUniformLocation(shaderProgram, "uScreenResolution");
        gl.uniform2f(uScreenResolutionLoc, canvas.width, canvas.height);
        var uRealLimitsLoc = gl.getUniformLocation(shaderProgram, "uRealLimits");
        gl.uniform2f(uRealLimitsLoc, re_min, re_max);
        var uImaginaryLimitsLoc = gl.getUniformLocation(shaderProgram, "uImaginaryLimits");
        gl.uniform2f(uImaginaryLimitsLoc, im_min, im_max);
        var uNumColoursLoc = gl.getUniformLocation(shaderProgram, "uNumColours");
        gl.uniform1i(uNumColoursLoc, num_colours);
        var uWeightLoc = gl.getUniformLocation(shaderProgram, "uWeight");
        gl.uniform1f(uWeightLoc, weight);

        var uColoursLoc = gl.getUniformLocation(shaderProgram, "uColours");
        gl.uniform4fv(uColoursLoc, colours);

        var uSetColourLoc = gl.getUniformLocation(shaderProgram, "uSetColour");
        if(is_coloured) {
            gl.uniform4f(uSetColourLoc, colours[0], colours[1], colours[2], colours[3]);
        } else {
            var black = [0.0, 0.0, 0.0, 1.0];
            gl.uniform4f(uSetColourLoc, black[0], black[1], black[2], black[3]);
        }
    }

    var squareVertexPositionBuffer;

    function initVertexBuffer() {
        squareVertexPositionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer);
        var vertices = [
             1.0,  1.0,
            -1.0,  1.0,
             1.0, -1.0,
            -1.0, -1.0
        ];
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
        squareVertexPositionBuffer.itemSize = 2;
        squareVertexPositionBuffer.numItems = 4;
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, squareVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
    }

    function draw() {
        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        gl.drawArrays(gl.TRIANGLE_STRIP, 0, squareVertexPositionBuffer.numItems);
    }

    var canvas, canvas_rect, is_fullscreen;

    function init() {
        canvas = document.getElementById("canvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        canvas.addEventListener("mousedown", mouseDown);
        canvas.addEventListener("mousemove", mouseMove);
        canvas.addEventListener("mouseup", mouseUp);
        canvas.addEventListener('mousewheel', function(event){
            mouseWheel(event);
            event.preventDefault();
        }, false);
        canvas.addEventListener("DOMMouseScroll", function(event){
            foxWheel(event);
            event.preventDefault();
        }, false);
        canvas.addEventListener("touchstart", touchStart);
        canvas.addEventListener("touchend", touchEnd);
        canvas.addEventListener("touchleave", touchEnd);
        canvas.addEventListener("touchmove", touchMove);
        initUi();
        initGL(canvas);
        initMandel();
        initShaders();
        initVertexBuffer();
        is_fullscreen = true;
        canvas_rect = canvas.getBoundingClientRect();
        normalise();

        gl.clearColor(0.0, 0.0, 0.0, 1.0);

        draw();
    }

    function reset() {
        initUi();
        initMandel();
        initShaders();
        normalise();

        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.enable(gl.DEPTH_TEST);

        draw();
    }

    function resize() {
        if(is_fullscreen) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            normalise();
        }
        canvas_rect = canvas.getBoundingClientRect();

        initGL(canvas);
        initVertexBuffer();
        updateUniforms();
        draw();
    }

    function fullscreen() {
        if(is_fullscreen) {
            canvas.width = 400;
            canvas.height = 400;
            is_fullscreen = false;
        } else {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            is_fullscreen = true;
        }
        resize();
        normalise();
    }

    var new_x1, new_y1, new_x2, new_y2, old_x1, old_y1, old_x2, old_y2, id1, id2, clicked = false, pinched = false;
    function mouseDown(event) {
        new_x1 = old_x1 = event.pageX - canvas_rect.left;
        new_y1 = old_y1 = event.pageY - canvas_rect.top;
        clicked = true;
    }

    function mouseMove(event) {
        new_x1 = event.pageX - canvas_rect.left;
        new_y1 = event.pageY - canvas_rect.top;
        if(clicked) {
            var xDist = (new_x1 - old_x1) / canvas.width;
            var yDist = (new_y1 - old_y1) / canvas.height;
            doTranslate(xDist, yDist);
        }
        old_x1 = new_x1;
        old_y1 = new_y1;
    }

    function mouseUp(event) {
        clicked = false;
    }

    function mouseWheel(event) {
        var wheel = event.wheelDelta;
        zoom = Math.pow(1.001, wheel);
        var xDist = (event.pageX - canvas_rect.left) / canvas.width;
        var yDist = (event.pageY - canvas_rect.top) / canvas.height;
        doZoomTo(xDist, yDist, zoom);
    }

    function foxWheel(event) {
        var wheel = - event.detail * 10;
        zoom = Math.pow(1.001, wheel);
        var xDist = (event.pageX - canvas_rect.left) / canvas.width;
        var yDist = (event.pageY - canvas_rect.top) / canvas.height;
        doZoomTo(xDist, yDist, zoom);
    }

    function touchStart(event) {
        event.preventDefault();
        if(event.targetTouches.length === 1) {
            id1 = event.targetTouches[0].identifier;
            new_x1 = old_x1 = event.targetTouches[0].pageX - canvas_rect.left;
            new_y1 = old_y1 = event.targetTouches[0].pageY - canvas_rect.top;
        } else if(event.targetTouches.length === 2) {
            id1 = event.targetTouches[0].identifier;
            id2 = event.targetTouches[1].identifier;
            new_x1 = old_x1 = event.targetTouches[0].pageX - canvas_rect.left;
            new_y1 = old_y1 = event.targetTouches[0].pageY - canvas_rect.top;
            new_x2 = old_x2 = event.targetTouches[1].pageX - canvas_rect.left;
            new_y2 = old_y2 = event.targetTouches[1].pageY - canvas_rect.top;
        }
    }

    function touchMove(event) {
        event.preventDefault();
        if(event.targetTouches.length === 1) {
            new_x1 = event.targetTouches[0].pageX - canvas_rect.left;
            new_y1 = event.targetTouches[0].pageY - canvas_rect.top;
            if(event.targetTouches[0].identifier === id1) {
                var xDist = (new_x1 - old_x1) / canvas.width;
                var yDist = (new_y1 - old_y1) / canvas.height;
                doTranslate(xDist, yDist);
            } else {
                id1 = event.targetTouches[0].identifier;
            }
            old_x1 = new_x1;
            old_y1 = new_y1;
        } else if(event.targetTouches.length === 2) {
            new_x1 = event.targetTouches[0].pageX - canvas_rect.left;
            new_y1 = event.targetTouches[0].pageY - canvas_rect.top;
            new_x2 = event.targetTouches[1].pageX - canvas_rect.left;
            new_y2 = event.targetTouches[1].pageY - canvas_rect.top;
            if(event.targetTouches[0].identifier === id1 && event.targetTouches[1].identifier === id2) {
                var xPinchOld = old_x1 - old_x2;
                var yPinchOld = old_y1 - old_y2;
                var pinchOld = Math.sqrt(xPinchOld * xPinchOld + yPinchOld * yPinchOld);
                var xPinchNew = new_x1 - new_x2;
                var yPinchNew = new_y1 - new_y2;
                var pinchNew = Math.sqrt(xPinchNew * xPinchNew + yPinchNew * yPinchNew);
                var xDist = (new_x1 + new_x1) / 2 / canvas.width;
                var yDist = (new_y1 + new_y2) / 2 / canvas.height;
                doZoomTo(xDist, yDist, pinchNew / pinchOld);
            } else {
                id1 = event.targetTouches[0].identifier;
                id2 = event.targetTouches[0].identifier;
            }
            old_x1 = new_x1;
            old_y1 = new_y1;
            old_x2 = new_x2;
            old_y2 = new_y2;
        }
    }

    function touchEnd(event) {
        event.preventDefault();
    }

    function toggle(id) {
        if(document.getElementById(id).style.display == "none") {
            document.getElementById(id).style.display = "block";
        } else {
            document.getElementById(id).style.display = "none";
        }
    }

    var re_min, re_max, im_min, im_max, colours, num_colours, weight, is_coloured;
    function initMandel() {
        re_min = -2.25;
        re_max = 0.75;
        im_min = -1.5;
        im_max = 1.5;
        colours = [
            1.0, 0.0, 0.0, 1.0,
            1.0, 1.0, 1.0, 1.0,
            0.0, 0.0, 1.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 1.0
        ];
        num_colours = 3;
        weight = 0.5;
        is_coloured = false;
    }

    function normalise() {
        var ratio = canvas.width / canvas.height;
        var reWidth = re_max - re_min;
        var imHeight = im_max - im_min;
        var cur = reWidth / imHeight;
        var diff = ratio - cur;

        if(diff > 0.001 || diff < -0.001) {
            var im_adj = (reWidth / ratio - imHeight) / 2.0;
            im_max += im_adj;
            im_min -= im_adj;
        }

        updateUniforms();
        draw();
    }

    function adjColour(colourID, colourElem, colourVal) {
        if(colourElem == "red"){
            colours[(colourID - 1) * 4] = colourVal / 255;
        } else if(colourElem == "green"){
            colours[(colourID - 1) * 4 + 1] = colourVal / 255;
        } else if(colourElem == "blue"){
            colours[(colourID - 1) * 4 + 2] = colourVal / 255;
        } else {
            return;
        }

        updateUniforms();
        draw();
    }

    function adjColoured() {
        if(is_coloured == true) {
            is_coloured = false;
        } else {
        is_coloured = true;
        }
        updateUniforms();
        draw();
    }

    function adjWeight(val) {
        weight = val / 1000;
        updateUniforms();
        draw();
    }

    function initUi() {
        $( "button" )
        .button();
        $( "#numColours" ).val(3);
        $( "#numColours" ).change(function () {
            num_colours = $(this).val();
            initShaders();
            draw();
        });
        $( "#pickColour" ).val(1);
        $( "#pickColour" ).change(function () {
            var val = $(this).val() - 1;
            $("#red").slider('value', colours[val * 4] * 255);
            $("#green").slider('value', colours[val * 4 + 1] * 255);
            $("#blue").slider('value', colours[val * 4 + 2] * 255);
        });
        $("#weight" )
        .slider({
            min: 0,
            max: 1000,
            value: 500,
            slide: function( event, ui ) {
                adjWeight(ui.value);
            }
        });
        $( "#red")
        .slider({
            range: "min",
            min: 0,
            max: 255,
            value: 255,
            slide: function( event, ui ) {
                var curColour = $( "#pickColour").val();
                adjColour(curColour, "red", ui.value);
            }
        });
        $( "#green")
        .slider({
            range: "min",
            min: 0,
            max: 255,
            value: 0,
            slide: function( event, ui ) {
                var curColour = $( "#pickColour").val();
                adjColour(curColour, "green", ui.value);
            }
        });
        $( "#blue")
        .slider({
            range: "min",
            min: 0,
            max: 255,
            value: 0,
            slide: function( event, ui ) {
                var curColour = $( "#pickColour").val();
                adjColour(curColour, "blue", ui.value);
            }
        });
    }

    function doTranslate(xDist, yDist) {
        var reWidth = re_max - re_min;
        var imHeight = im_max - im_min;
        var reAdj = reWidth * xDist;
        var imAdj = imHeight * yDist;
        re_max -= reAdj;
        re_min -= reAdj;
        im_max += imAdj;
        im_min += imAdj;

        updateUniforms();
        draw();
    }

    function doZoom(zoom) {
        var reWidth = re_max - re_min;
        var imHeight = im_max - im_min;
        var x = re_min + reWidth / 2;
        var y = im_max - imHeight / 2;
        var newWidth = reWidth / zoom;
        var newHeight = imHeight / zoom;
        re_max = x + newWidth / 2;
        re_min = x - newWidth / 2;
        im_max = y + newHeight / 2;
        im_min = y - newHeight / 2;

        updateUniforms();
        draw();
    }

    function doZoomTo(xDist, yDist, zoom) {
        var reWidth = re_max - re_min;
        var imHeight = im_max - im_min;
        var newWidth = reWidth / zoom;
        var newHeight = imHeight / zoom;

        re_max -= (reWidth - newWidth) * (1 - xDist);
        re_min += (reWidth - newWidth) * xDist;
        im_max -= (imHeight - newHeight) * yDist;
        im_min += (imHeight - newHeight) * (1 - yDist);

        updateUniforms();
        draw();
    }

    var currentAction = undefined;

    function printDialog( content, action, timeout ) {
        var popup = document.querySelector('.popup');
        popup.innerHTML = content;

        if(action) {
            currentAction = action;
            popup.addEventListener('click', action);
        }

        if(timeout) {
            setTimeout( removeDialog, timeout );
        }

        var popupWrap = document.querySelector('.popupWrap');
        popupWrap.className = 'popupWrap';
    }

    function removeDialog() {
        var popup = document.querySelector('.popup');
        popup.removeEventListener('click', currentAction);

        var popupWrap = document.querySelector('.popupWrap');
        popupWrap.className = 'popupWrap hidden';
    }

    function screenshot() {
        var data = canvas.toDataURL("image/png");
        printDialog(
            '<p class="popupText">Click <a href="' + data + '" download="screenshot">here</a> to download the screenshot.</p>',
            removeDialog,
            false
        );
    }
    </script>

</body>

</html>
